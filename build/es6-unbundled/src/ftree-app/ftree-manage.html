<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html"><link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html"><link rel="import" href="../../bower_components/paper-button/paper-button.html"><link rel="import" href="../../bower_components/paper-styles/color.html"><link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../../bower_components/iron-form/iron-form.html"><link rel="import" href="../../bower_components/iron-icons/maps-icons.html"><link rel="import" href="../../bower_components/iron-icon/iron-icon.html"><link rel="import" href="./ftree-member.html"><link rel="import" href="./addftree-member.html"><link rel="import" href="./ftree-form.html"></head><body><dom-module id="ftree-manage"><template><style>:host{display:block;}paper-button{border-color:#FDF3E7;border-style:solid;color:white;}.header{background-color:#339ACC;border-radius:5px;display:inline-block;padding:10px;padding-right:75px;position:relative;}.header>img{position:absolute;top:-3px;right:15px;height:50px;width:auto;}addftree-member{height:0px;overflow:hidden;}#ftreeholder{white-space:nowrap;overflow:visible;padding:0 auto;}</style><h2 class="header" style="margin:2%">Family Tree <img src="/src/ftree-app/icon/tree.png"></h2><br><template is="dom-if" if="[[!showfamily(ftree,me)]]"><paper-button style="margin:2%" on-click="createfamilyftree"><b>create New Family Tree</b></paper-button></template><div id="ftreeholder"></div><ftree-form id="ftreeform" users="[[users]]"></ftree-form></template><script>class FtreeManage extends Polymer.Element{static get is(){return'ftree-manage'}static get properties(){return{prop1:{type:String,value:'ftree-app'},nav:{type:Object,value:function(){return{}}},users:Object,ftree:{type:Object,value:function(){return{}}},ftreep:String,database:{type:Object,readonly:!0,value:function(){return firebase.database()}},me:{type:String}}}ready(){super.ready();var a=this;a.ftreep='ftree/users/'+a.users.uid+'/ftree',a.database.ref(a.ftreep).on('value',function(b){var c=a.$.ftreeholder;if(null==b.val())return c.innerHTML='',a.ftree=null,!1;a.me=b.val().root.rootid.toString();var d=b.val();a.ftree=d,delete d.root,c.innerHTML='';var e=document.createElement('ftree-member');e.id='ctree',e.member=a.ftree,e.me=a.me,e.users=a.users,c.appendChild(e)})}detached(){self.database.ref(self.ftreep).off()}connectedCallback(){super.connectedCallback();var a=this,b=a.$.ftreeform;return null!=b&&void(window.addEventListener('updateself',function(c){var e=c.detail,d={},f=Object.keys(e);if(0<f.length){var g=a.ftreep+'/'+f[0];d[g]=e[f[0]],firebase.database().ref().update(d).then(function(){b.appear=!1})}}),window.addEventListener('addchild',function(c){var e=c.detail.data,d=c.detail.parent,f=Object.keys(e),g=firebase.database().ref(a.ftreep).push().key,h={};e.p=d,e.c=null,e.date=firebase.database.ServerValue.TIMESTAMP,h[a.ftreep+'/'+g]=e,h[a.ftreep+'/'+d+'/c/'+g]=g,firebase.database().ref().update(h).then(function(){b.appear=!1})}),window.addEventListener('addparent',function(c){var e=c.detail.data,d=c.detail.parent,f=Object.keys(e),g=a.ftree[d].p,h=firebase.database().ref(a.ftreep).push().key,i={};e.p=g,e.c={},e.c[d]=d,e.date=firebase.database.ServerValue.TIMESTAMP,d==a.me?(i['ftree/users/'+a.users.uid+'/ftree/root']={rootid:h},e.p='--'):(i[a.ftreep+'/'+g+'/c/'+h]=h,i[a.ftreep+'/'+g+'/c/'+d]=null),i[a.ftreep+'/'+h]=e,i[a.ftreep+'/'+d+'/p']=h,firebase.database().ref().update(i).then(function(){b.appear=!1})}),window.addEventListener('deletefire',function(c){function e(b,c,d,f){var b=b,c=c,d=d,f=f;if('undefined'!=typeof c&&c.hasOwnProperty('c'))for(var g in c.c)d[a.ftreep+'/'+g]=null,f.push(g);if(0<f.length){var h=f.pop();e(b,b[h],d,f)}return d}var f=c.detail,g={};if(a.me!=f){g[a.ftreep+'/'+f]=null;var d=a.ftree[f].p;g[a.ftreep+'/'+d+'/c/'+f]=null,g=e(a.ftree,a.ftree[f],g,[])}else g[a.ftreep]=null;return{}!=g&&void firebase.database().ref().update(g).then(function(){b.appear=!1})}),window.addEventListener('showmember',function(b){var c=a.$.ftreeform;return null!=c&&void(c.parentele=b.detail,c.formdata=a.ftree[b.detail.getAttribute('parent')],c.meid=b.detail.getAttribute('parent'),c.appearcb={},c.appearcb.action=function(b){a.$.ftreeholder.style.display=b?'none':'block'},c.appear=!0)}),a.addEventListener('dom-change',function(){}))}createfamilyftree(){self=this;var a=self.database.ref('ftree/users/'+this.users.uid).push().key,b={};b['ftree/users/'+this.users.uid+'/ftree/'+a]={name:self.users.displayName,p:'--',c:null,date:firebase.database.ServerValue.TIMESTAMP},b['ftree/users/'+this.users.uid+'/ftree/root']={rootid:a},self.database.ref().update(b)}showaddftree(){var a=this.$.addftreemember;a.open(),console.log(this.users)}showfamily(a,b){if('object'!=typeof a||null==a)return!1;var c=Object.keys(a);return!!(0<=c.indexOf(b))}ftreeinterface(){return{name:'--',p:'--',c:'--',date:firebase.database.ServerValue.TIMESTAMP}}}window.customElements.define(FtreeManage.is,FtreeManage);</script></dom-module></body></html>